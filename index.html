<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Fakenews</title>
        <link href="gfx/favicon.png" rel="icon" type="image/png">
        <link href="css/fa/styles/fontawesome.min.css" rel="stylesheet">
        <link href="css/fa/styles/solid.min.css" rel="stylesheet">
        <link href="css/fa/styles/brands.min.css" rel="stylesheet">
        <link href="css/global.css" rel="stylesheet">
        <link href="css/index.css" rel="stylesheet">
        <script src="js/Elem.js"></script>
        <script src="js/Evnt.js"></script>
        <script src="js/Each.js"></script>
        <script src="js/UploadFile.js"></script>
        <script src="js/LoadImage.js"></script>
        <script src="js/StringConvert.js"></script>
        <script src="js/Accordeon.js"></script>
        <script src="js/Menu.js"></script>
        <script src="js/dom-to-image.js"></script>
        <!--script src="js/wiki2html.js"></script-->
        <meta property="og:url" content="http://fakenews.loc/">
        <meta property="og:title" content="FakeNews!">
        <meta property="og:description" content="Stránka pro vytváření falešných náhledů článků">
        <!--meta property="og:image" content="http://static01.nyt.com/images/2015/02/19/arts/international/19iht-btnumbers19A/19iht-btnumbers19A-facebookJumbo-v2.jpg"-->
        <meta property="og:app_id" content="2046451405476029">
        <meta property="og:locale" content="cs_CZ">
    </head>
    <body>
        <script>

console.log("FB script start");

function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
    console.log('statusChangeCallback');
    console.log(response);                   // The current login status of the person.
    if (response.status === 'connected') {   // Logged into your webpage and Facebook.
      testAPI();
    } else {                                 // Not logged into your webpage or we are unable to tell.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into this webpage.';
    }
  }


  function checkLoginState() {               // Called when a person is finished with the Login Button.
    FB.getLoginStatus(function(response) {   // See the onlogin handler
      statusChangeCallback(response);
    });
  }


  window.fbAsyncInit = function() {
    FB.init({
      appId      : '2046451405476029',
      cookie     : true,                     // Enable cookies to allow the server to access the session.
      xfbml      : true,                     // Parse social plugins on this webpage.
      version    : 'v14.0'                   // Use this Graph API version for this call.
    });


    FB.getLoginStatus(function(response) {   // Called after the JS SDK has been initialized.
      statusChangeCallback(response);        // Returns the login status.
    });
  };

  function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
      console.log('Successful login for: ' + response.name);
      document.getElementById('status').innerHTML =
        'Thanks for logging in, ' + response.name + '!';
    });
  }

        </script>
        <div class="container">
            <div class="row">
                <div class="column width-7">
                    <h1>Fake news!</h1>
                </div>
                <div class="column width-4 align-right">
                    <ul id="menu-main" data-menu-name="menu-main" data-menu-default="#panel-editor">
                        <li>Menu:</li>
                        <li data-menu-target="#panel-editor">Editor</li>
                        <li data-menu-target="#panel-help">Nápověda &amp; kredity</li>
                    </ul>
                </div>
                <div class="column-width-1">
                    <div id="btn-download"><i class="fas fa-download"></i></div>
                    <!--div id="btn-share"><i class="fab fa-facebook"></i></div-->
                </div>
            </div>
        </div><!-- /.container -->
        <div class="container menu-panel" id="panel-editor" data-menu-name="menu-main">
            <div class="row">
                <div class="column width-7">
                    <div id="canvas-wrapper">
                        <div id="canvas" class="web horizontal" style="clear: both;">
                            <h2 id="canvas-title"></h2>
                            <div class="datetime"><i class="fas fa-calendar-alt"></i> <span id="canvas-datetime"></span></div>
                            <div class="perex"></div>
                            <figure id="canvas-image">
                                <div class="image"><div class="picture"></div><div class="raster"></div><div class="border"></div></div>
                                <figcaption id="canvas-image-description">Popisek pod obrázkem | foto ČTK</figcaption>
                            </figure>
                            <div class="article"></div>
                            <!--div class="signature" style="order: 6;">
                                <p class="generator">Vygenerováno pomocí <span class="bold">https://spaceboy.github.io/fakenews/</span></p>
                            </div-->
                            <div class="clear"></div>
                        </div><!-- /#canvas -->
                    </div><!-- /#canvas-wraper -->
                </div><!-- /.column -->
                <div class="column width-5">
                    <form id="form-main">
                        <table class="editor">
                            <thead>
                                <tr>
                                    <th colspan="3"><h3 data-accordeon="table-block-title">Titulek &amp; datum</h3></th>
                                </tr>
                            </thead>
                            <tbody id="table-block-title">
                                <tr>
                                    <th><label for="form-title">Titulek</label></th>
                                    <td colspan="2"><input name="title" id="form-title" type="text" placeholder="Sem vepište titulek zprávy" data-default-value="Měsíc trvá už mnoho měsíců, zjistili brněnští vědci"></td>
                                </tr>
                                <tr>
                                    <th><label for="form-title-align">Zarovnání</label></th>
                                    <td colspan="2"><select name="title-align" id="form-title-align" data-default-value="left"><option value="left">doleva</option><option value="justify">do bloku</option><option value="center">na střed</option><option value="right">doprava</option></select></td>
                                </tr>
                                <tr>
                                    <th><label for="form-date">Datum</label></th>
                                    <td colspan="2"><input name="date" id="form-date" type="text" placeholder="Vložte datum (např. 15.7.2022)" data-default-value=""></td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr>
                                    <th colspan="3"><h3 data-accordeon="table-block-perex">Perex</h3></th>
                                </tr>
                            </thead>
                            <tbody id="table-block-perex">
                                <tr>
                                    <th><label for="form-perex">Perex</label></th>
                                    <td colspan="2"><textarea name="perex" id="form-perex" placeholder="Sem vepište perex, zvýrazněný první odstavec článku" data-default-value="Po mnohaměsíčním úsilí brněnští vědci zjistili, že Měsíc je starší, než jsme čekali. Podle jejich měření trvá už nejméně třiatřicet měsíců."></textarea></td>
                                </tr>
                                <tr>
                                    <th><label for="form-perex-align">Zarovnání</label></th>
                                    <td colspan="2"><select name="perex-align" id="form-perex-align" data-default-value="justify"><option value="left">doleva</option><option value="justify">do bloku</option><option value="center">na střed</option><option value="right">doprava</option></select></td>
                                </tr>
                                <tr>
                                    <th><label for="form-perex-position">Pozice perexu</label></th>
                                    <td colspan="2"><select name="perex-position" id="form-perex-position" title="Změna pozice je možná pouze pokud je obrázek zobrazen v plné šířce."><option value="before">Před obrázkem</option><option value="after">Za obrázkem</option></select></td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr>
                                    <th colspan="3"><h3 data-accordeon="table-block-image">Obrázek</h3></th>
                                </tr>
                            </thead>
                            <tbody id="table-block-image">
                                <tr>
                                    <th><label for="form-image">Obrázek</label></th>
                                    <td colspan="2"><input name="image" id="form-image" type="file"></td>
                                </tr>
                                <tr>
                                    <th><label for="form-image-url">Obrázek (URL)</label></th>
                                    <td colspan="2"><input name="image-url" id="form-image-url" type="text" data-default-value="https://spaceboy.github.io/fakenews/gfx/test01-half-moon.jpg"></td>
                                </tr>
                                <tr class="short">
                                    <th rowspan="13"></th>
                                    <th><label for="form-image-height">Výška)</label></th>
                                    <td colspan="2"><input name="image-height" id="form-image-height" type="number" min="100" max="1000" data-postfix="px"><button id="form-image-height-auto" name="image-height-auto">Automaticky</button></td>
                                </tr>
                                <tr>
                                    <th><label for="form-image-width">Šířka</label></th>
                                    <td colspan="2"><select name="image-width" id="form-image-width" data-default-value="fullwidth"><option value="fullwidth">Plná šířka</option><option value="halfwidth">Poloviční šířka</option></select></td>
                                </tr>
                                <tr class="short">
                                    <th><label>Zarovnání</label></th>
                                    <td><select id="form-image-align-horizontal" name="image-align-horizontal" data-default-value="center"><option value="left">doleva</option><option value="center">na střed</option><option value="right">doprava</option></select><select id="form-image-align-vertical" name="image-align-vertical" data-default-value="center"><option value="top">nahoru</option><option value="center">na střed</option><option value="bottom">dolů</option></select></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-filter-blur">Rozmazání</label></th>
                                    <td><input id="form-image-filter-blur" name="blur" type="range" min="0" max="2" step="0.1" value="0" data-postfix="px" data-group="filter"></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-filter-grayscale">ČB</label></th>
                                    <td><input id="form-image-filter-grayscale" name="grayscale" type="range" min="0" max="100" step="25" value="0" data-postfix="%" data-group="filter"></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-filter-sepia">Sépie</label></th>
                                    <td><input id="form-image-filter-sepia" name="sepia" type="range" min="0" max="100" step="25" value="0" data-postfix="%" data-group="filter"></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-filter-contrast">Kontrast</label></th>
                                    <td><input id="form-image-filter-contrast" name="contrast" type="range" min="0" max="200" step="25" value="100" data-postfix="%" data-group="filter"></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-blured-border">Rozpitý okraj</label></th>
                                    <td><input id="form-image-blured-border" name="blured-border" type="range" min="0" max="5" step="1" value="0" data-postfix="px"></td>
                                </tr>
                                <tr class="short">
                                    <td></td>
                                    <td><label for="form-image-raster"><input name="image-raster" id="form-image-raster" type="checkbox"> Novinový rastr</label></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-raster-size">Velikost zrna</label></th>
                                    <td><input id="form-image-raster-size" name="raster-size" type="range" min="5" max="60" step="5" value="35" data-postfix="%" data-group="raster"></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-raster-granularity">Zrnitost</label></th>
                                    <td><input id="form-image-raster-granularity" name="raster-granularity" type="range" min="5" max="35" step="5" value="10" data-group="raster"></td>
                                </tr>
                                <tr class="short">
                                    <th><label for="form-image-raster-opacity">Intenzita</label></th>
                                    <td><input id="form-image-raster-opacity" name="raster-opacity" type="range" min=".05" max="1" step=".05" value=".15" data-group="raster"></td>
                                </tr>
                                <tr class="short">
                                    <td></td>
                                    <td><label for="form-image-raster-light"><input name="raster-light" id="form-image-raster-light" type="checkbox"> Světlý</label></td>
                                </tr>
                                <tr>
                                    <th><label for="form-image-description">Popisek</label></th>
                                    <td colspan="2"><textarea name="image-description" id="form-image-description" data-default-value="Měsíc je starší, než brněnští vědci pamatují"></textarea></td>
                                </tr>
                                <tr>
                                    <th><label for="form-image-author">Autor</label></th>
                                    <td colspan="2"><input name="image-author" id="form-image-author" type="text" value="foto ČTK" placeholder="foto ČTK" data-default-value="foto JPP"></textarea></td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr>
                                    <th colspan="3"><h3 data-accordeon="table-block-article">Článek</h3></th>
                                </tr>
                            </thead>
                            <tbody id="table-block-article">
                                <tr>
                                    <th><label for="form-agency">Agentura</label></th>
                                    <td colspan="2"><input name="agency" id="form-agency" type="text" value="Praha (ČTK)" placeholder="Praha (ČTK)"></td>
                                </tr>
                                <tr>
                                    <th><label for="form-article">Článek</label></th>
                                    <td colspan="2"><textarea name="article" id="form-article"></textarea></td>
                                </tr>
                                <tr>
                                    <th><label for="form-article-align">Zarovnání</label></th>
                                    <td colspan="2"><select name="article-align" id="form-article-align" data-default-value="justify"><option value="left">doleva</option><option value="justify">do bloku</option><option value="center">na střed</option><option value="right">doprava</option></select></td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr>
                                    <th colspan="3"><h3 data-accordeon="table-block-setup">Nastavení</h3></th>
                                </tr>
                            </thead>
                            <tbody id="table-block-setup">
                                <tr>
                                    <th><label for="form-template">Šablona</label></th>
                                    <td colspan="2"><select name="template" id="form-template"><option value="web">Webový článek</option><option value="press">Tiskový článek</option><option value="retro">Starý tiskový článek</option><option value="vintage">Velmi starý článek</option><option value="vintage2">Velmi starý článek (2)</option><option value="historic">Historický spis</option></select></td>
                                </tr>
                                <tr>
                                    <th><label for="form-filename">Název obrázku</label></th>
                                    <td colspan="2"><input id="form-filename" name="filename" placeholder="Např. fakenews" value="fakenews"></td>
                                </tr>
                                <tr>
                                    <th><label for="form-fileformat">Typ obrázku</label></th>
                                    <td colspan="2"><select id="form-fileformat" name="fileformat"><option value="jpg">JPG</option><option value="png">PNG</option></select></td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                </div><!-- /.column-->
            </div><!-- /.row -->
        </div><!-- /.container -->
        <div class="container menu-panel" id="panel-help" data-menu-name="menu-main">
            <div class="row">
                <div class="column width-8">
                    <h2>Jak používat editor</h2>
                    <p>
                        Při psaní textu můžete využít &lt;i&gt;HTML formátování&lt;/i&gt; i jednoduchých značek
                        pro <b>*tučné písmo,*</b> <i>_kurzívu,_</i> <u>=podtržení=</u>, <s>~přešktrtnutí~</s>&hellip;
                    </p>
                    <p>
                        Tři tečky <b>...</b> budou nahrazeny trojtečkou“ (&hellip;).
                    </p>
                    <p>
                        Nový řádek vytvoří nový odstavec.
                    </p>
                    <p>
                        „Počítačové“ uvozovky (") budou nahrazeny ‚typografickými,‘ ale „zdvojené“
                        uvozovky či apostrof (') zůstanou zachovány (např. <b>10(^o), 20'' 30""</b> se
                        zobrazí jako <b>10°, 20' 30"</b>).
                    </p>
                    <p>
                        Některé speciální značky lze zapsat jako kombinaci běžných znaků:
                    </p>
                    <table class="entities-list">
                        <tbody>
                            <tr>
                                <th>(1/4)</th><td>&frac14;</td>
                                <th>(1/2)</th><td>&frac12;</td>
                                <th>(3/4)</th><td>&frac34;</td>
                                <th>(%%)</th><td>&permil;</td>
                            </tr>
                            <tr>
                                <th>(^o)</th><td>&deg;</td>
                                <th>(*)</th><td>&times;</td>
                                <th>(/)</th><td>&divide;</td>
                                <th>(oo)</th><td>&infin;</td>
                            </tr>
                            <tr>
                                <th>(~=)</th><td>&asymp;</td>
                                <th>(!=)</th><td>&ne;</td>
                                <th>(>=)</th><td>&ge;</td>
                                <th>(<=)</th><td>&le;</td>
                            </tr>
                            <tr>
                                <th>(+/-)</th><td>&plusmn;</td>
                                <th>(PI)</th><td>&pi;</td>
                                <th>(,u)</th><td>&micro;</td>
                                <th>(v-)</th><td>&radic;</td>
                            </tr>
                            <tr>
                                <th>(+-)</th><td>&dagger;</td>
                                <th>(++)</th><td>&Dagger;</td>
                                <th>(SS)</th><td>&sect;</td>
                                <th>(f)</th><td>&fnof;</td>
                            </tr>
                            <tr>
                                <th>(&lt;&gt;)</th><td>&diams;</td>
                                <th>(&lt;3)</th><td>&hearts;</td>
                                <th>(-&gt;)</th><td>&spades;</td>
                                <th>(-3)</th><td>&clubs;</td>
                            </tr>
                            <tr>
                                <th>(&lt;=&gt;)</th><td>&harr;</td>
                                <th>(&lt;=)</th><td>&larr;</td>
                                <th>(=&gt;)</th><td>&rarr;</td>
                                <th>(&lt;&lt;&gt;&gt;)</th><td>&loz;</td>
                            </tr>
                            <tr>
                                <th>(E)</th><td>&euro;</td>
                                <th>(L)</th><td>&pound;</td>
                                <th>(Y)</th><td>&yen;</td>
                                <th>(C)</th><td>&cent;</td>
                            </tr>
                            <tr>
                                <th>(r)</th><td>&reg;</td>
                                <th>(c)</th><td>&copy;</td>
                                <th>(tm)</th><td>&trade;</td>
                                <th></th><td></td>
                            </tr>
                            <tr>
                                <th>---</th><td>&mdash;</td>
                                <th>--</th><td>&ndash;</td>
                                <th>^?</th><td>&iquest;</td>
                                <th>^!</th><td>&iexcl;</td>
                            </tr>
                            <tr>
                                <th>...</th><td>&hellip;</td>
                                <th>__</th><td>&#95;</td>
                                <th>(_)</th><td><sup>*</sup></td>
                                <th>(-)</th><td><sup>*</sup></td>
                            </tr>
                        </tbody>
                    </table>
                    <p>
                        <b>*)</b> Velmi speciální kombinace jsou <b>(_)</b> a <b>(-)</b>.
                        Ty slouží pro formátování textu. První je nahrazená HTML entitou <b>&amp;nbsp;</b>, tedy pevnou mezerou.
                        Druhá vkládá HTML entitu <b>&amp;shy;</b>, která označuje místo, kde se může (ale nemusí) rozdělit dlouhé slovo.
                    </p>
                </div>
                <div class="column width-4">
                    <h2>Kredity a uznání</h2>
                    <p>
                        Tuto aplikaci by nebylo možné vytvořit bez knihovny
                        <a href="https://github.com/tsayen/dom-to-image">dom-to-image</a>.
                    </p>
                    <p>
                        Písma <span class="font-prager-headlines">Prager Headlines</span> a <span class="font-volkszeitung-21">Volkszeitung 21</span>
                        vytvořil Lukáš Krákora. Jeho další fonty můžete nalézt na adresách <a href="https://www.typewriterfonts.net">www.typewriterfonts.net</a>
                        a <a href="https://www.dafont.com/lukas-krakora.d1281">www.dafont.com/lukas-krakora.d1281</a>, FB stránku na <a href="https://facebook.com/typewriterfonts">facebook.com/typewriterfonts</a>.
                    </p>
                </div>
            </div>
        </div><!-- /.container -->

        <!--fb:login-button scope="public_profile,publish_actions" onlogin="checkLoginState();"></fb:login-button>
        <div id="status"></div-->

        <script src="js/indexEvents.js"></script>
        <script src="js/index.js"></script>

        <script>

const dataURItoBlob = (dataURI) => {
    let byteString = atob(dataURI.split(',')[1]);
    let ab = new ArrayBuffer(byteString.length);
    let ia = new Uint8Array(ab);
    for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }
    return new Blob([ia], {
        type: 'image/jpeg'
    });
}
const shareOnFb = async (dataUrl, response) => {
    let formData = new FormData();
    formData.append('access_token', response.authResponse.accessToken);
    formData.append('source', dataURItoBlob(dataURL));

    let responseFB = await fetch(
        "https://graph.facebook.com/me/photos",
        {
            body: formData,
            method: 'post'
        }
    );
    responseFB = await responseFB.json();
    console.log(responseFB);
};

function shareImage () {
    domtoimage
        .toJpeg(document.getElementById("canvas"))
        .then((dataUrl) => {
            console.log("shareImage then");
            FB.login((response) => {
                console.log("FB.login response", response);
                //TODO check if user is logged in and authorized publish_actions
                shareOnFb(dataUrl, response);
            }, {scope: 'publish_actions'})
        })
        .catch((error) => console.log("shareImage", error));
}


        </script>
        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
    </body>
</html>
